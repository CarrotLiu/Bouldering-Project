<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sketch | three + p5 + node + socket</title>

    <link rel="stylesheet" href="style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.2/addons/p5.sound.min.js"></script>
    <script src="script.js"></script>
  </head>
  <body>
    
    <div id="container-three"></div>
    <div id="container-p5"></div>
    <div class="elements">
      <p id="status">Click "Start" to begin listening...</p>
      <button id="startButton">Start</button>
      <button id="stopButton" disabled>Stop</button>
      <p>Detected Words: <span id="detectedWords"></span></p>
      
    </div>

  <script>
    // 自定义词汇列表
    const detectWords = ["challenge", "give", "climbing", "fun", "game", "interesting"];

    // 页面元素
    const statusElement = document.getElementById("status");
    const detectedWordsElement = document.getElementById("detectedWords");
    const startButton = document.getElementById("startButton");
    const stopButton = document.getElementById("stopButton");

    // Web Speech API 初始化
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();

    recognition.lang = "en-US"; // 设置语言
    recognition.continuous = true; // 连续监听
    recognition.interimResults = false; // 仅返回完整结果

    let detected = []; // 存储检测到的词汇

    // 开始监听
    startButton.addEventListener("click", () => {
      detected = []; // 清空检测列表
      detectedWordsElement.textContent = "";
      statusElement.textContent = "Listening for speech...";
      recognition.start();
      startButton.disabled = true;
      stopButton.disabled = false;
    });

    // 停止监听
    stopButton.addEventListener("click", () => {
      recognition.stop();
      statusElement.textContent = "Stopped listening.";
      startButton.disabled = false;
      stopButton.disabled = true;
    });

    // 处理语音结果
    recognition.onresult = (event) => {
      const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
      console.log("Recognized:", transcript);

      // 匹配检测词汇
      detectWords.forEach(word => {
        if (transcript.includes(word) && !detected.includes(word)) {
          detected.push(word);
        }
      });

      // 更新页面
      detectedWordsElement.textContent = detected.join(", ");
    };

    // 错误处理
    recognition.onerror = (event) => {
      console.error("Speech recognition error:", event.error);
      statusElement.textContent = "Error occurred. Please try again.";
    };

    // 停止监听事件
    recognition.onend = () => {
      if (!stopButton.disabled) {
        statusElement.textContent = "Listening paused. Click 'Start' to resume.";
      }
    };
  </script>
  </body>
</html>
